module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/punycode [external] (punycode, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/node:fs [external] (node:fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:fs", () => require("node:fs"));

module.exports = mod;
}),
"[externals]/node:stream [external] (node:stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:stream", () => require("node:stream"));

module.exports = mod;
}),
"[externals]/node:stream/web [external] (node:stream/web, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:stream/web", () => require("node:stream/web"));

module.exports = mod;
}),
"[externals]/child_process [external] (child_process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[project]/app/api/generate-image/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "POST",
    ()=>POST
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$groq$2d$sdk$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/groq-sdk/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$externals$5d2f$child_process__$5b$external$5d$__$28$child_process$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/child_process [external] (child_process, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$util__$5b$external$5d$__$28$util$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/util [external] (util, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/path [external] (path, cjs)");
;
;
;
;
;
const execAsync = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$util__$5b$external$5d$__$28$util$2c$__cjs$29$__["promisify"])(__TURBOPACK__imported__module__$5b$externals$5d2f$child_process__$5b$external$5d$__$28$child_process$2c$__cjs$29$__["exec"]);
const groq = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$groq$2d$sdk$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["default"]({
    apiKey: process.env.GROQ_API_KEY || ''
});
async function POST(req) {
    try {
        const { prompt } = await req.json();
        if (!prompt || typeof prompt !== 'string') {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Prompt is required and must be a string'
            }, {
                status: 400
            });
        }
        console.log('Generating image for prompt:', prompt);
        // Step 1: Gunakan Llama untuk translate & enhance prompt (Indonesia → English)
        let enhancedPrompt = prompt;
        if (process.env.GROQ_API_KEY) {
            try {
                const completion = await groq.chat.completions.create({
                    messages: [
                        {
                            role: "system",
                            content: "You are an expert at creating image generation prompts. Translate Indonesian to English and create a detailed, high-quality prompt for Stable Diffusion. Include style descriptors like 'highly detailed, 8k uhd, studio lighting, professional, vivid colors'. Keep under 77 tokens. Return ONLY the prompt."
                        },
                        {
                            role: "user",
                            content: prompt
                        }
                    ],
                    model: "llama-3.3-70b-versatile",
                    temperature: 0.7,
                    max_tokens: 100
                });
                enhancedPrompt = completion.choices[0]?.message?.content?.trim() || prompt;
                console.log('Enhanced prompt:', enhancedPrompt);
            } catch (error) {
                console.log('Llama enhancement failed, using original prompt');
            }
        }
        // Step 2: Generate dengan Python Stable Diffusion (local GPU)
        const cleanPrompt = enhancedPrompt.substring(0, 200).trim();
        console.log(`Generating with local Stable Diffusion: ${cleanPrompt}`);
        try {
            const pythonScript = __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].join(process.cwd(), 'python-backend', 'generate_image.py');
            const pythonCommand = `python "${pythonScript}" "${cleanPrompt.replace(/"/g, '\\"')}"`;
            console.log('Executing Python script...');
            const { stdout, stderr } = await execAsync(pythonCommand, {
                timeout: 120000,
                maxBuffer: 10 * 1024 * 1024 // 10MB buffer for base64 image
            });
            if (stderr) {
                console.log('Python stderr:', stderr);
            }
            const result = JSON.parse(stdout);
            if (!result.success) {
                throw new Error(result.error || 'Python script failed');
            }
            const imageUrl = `data:image/png;base64,${result.imageBase64}`;
            console.log('✓ Image generated successfully with local Stable Diffusion');
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                imageUrl,
                prompt: prompt,
                enhancedPrompt: enhancedPrompt,
                method: 'local-stable-diffusion'
            });
        } catch (pythonError) {
            console.error('Local Stable Diffusion failed:', pythonError.message);
            // Fallback to Hugging Face API if Python fails
            console.log('Falling back to Hugging Face API...');
            if (!process.env.HUGGINGFACE_API_KEY) {
                throw new Error('Python failed dan Hugging Face API key tidak tersedia. Install: pip install -U diffusers transformers accelerate torch');
            }
            // Try multiple working free models as fallback
            const models = [
                'stabilityai/stable-diffusion-xl-base-1.0',
                'prompthero/openjourney-v4',
                'runwayml/stable-diffusion-v1-5'
            ];
            let imageBuffer = null;
            let usedModel = '';
            for (const model of models){
                try {
                    console.log(`Trying model: ${model}`);
                    const response = await fetch(`https://api-inference.huggingface.co/models/${model}`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${process.env.HUGGINGFACE_API_KEY}`
                        },
                        body: JSON.stringify({
                            inputs: cleanPrompt,
                            options: {
                                wait_for_model: true
                            }
                        })
                    });
                    if (response.ok) {
                        imageBuffer = await response.arrayBuffer();
                        usedModel = model;
                        console.log(`✓ Success with: ${model}`);
                        break;
                    }
                    const errorText = await response.text();
                    console.log(`✗ ${model} failed (${response.status}):`, errorText);
                } catch (error) {
                    console.log(`✗ HF ${model} error:`, error.message);
                }
            }
            if (!imageBuffer) {
                throw new Error('Local Python dan Hugging Face API semua gagal.');
            }
            // Convert to base64
            const base64Image = Buffer.from(imageBuffer).toString('base64');
            const imageUrl = `data:image/png;base64,${base64Image}`;
            console.log(`Image generated with HF fallback: ${usedModel}`);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                imageUrl,
                prompt: prompt,
                enhancedPrompt: enhancedPrompt,
                method: 'huggingface-fallback'
            });
        }
    } catch (error) {
        console.error('Error generating image:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: error.message || 'Gagal membuat gambar'
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__e679b957._.js.map