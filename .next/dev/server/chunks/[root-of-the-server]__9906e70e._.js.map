{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///D:/KULIAH%20SMT%207/ChatbotGenAi/app/api/generate-image/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { HfInference } from '@huggingface/inference';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const { prompt } = await req.json();\r\n\r\n        if (!prompt || typeof prompt !== 'string') {\r\n            return NextResponse.json(\r\n                { error: 'Prompt is required and must be a string' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        console.log('Generating image for prompt:', prompt);\r\n\r\n        // Cek apakah Hugging Face API key tersedia\r\n        if (!process.env.HUGGINGFACE_API_KEY) {\r\n            console.error('HUGGINGFACE_API_KEY is not configured');\r\n            return NextResponse.json(\r\n                { error: 'Hugging Face API key not configured. Please add HUGGINGFACE_API_KEY to .env.local' },\r\n                { status: 500 }\r\n            );\r\n        }\r\n\r\n        console.log('Calling Hugging Face API with official SDK...');\r\n\r\n        // Inisialisasi Hugging Face Inference client\r\n        const hf = new HfInference(process.env.HUGGINGFACE_API_KEY);\r\n\r\n        // Generate image menggunakan Stable Diffusion XL\r\n        const result = await hf.textToImage({\r\n            model: 'stabilityai/stable-diffusion-xl-base-1.0',\r\n            inputs: prompt,\r\n            parameters: {\r\n                negative_prompt: 'blurry, bad quality, low resolution',\r\n            }\r\n        });\r\n\r\n        console.log('Converting image to base64...');\r\n\r\n        // HfInference mengembalikan Blob, konversi ke base64\r\n        const arrayBuffer = await (result as unknown as Blob).arrayBuffer();\r\n        const buffer = Buffer.from(arrayBuffer);\r\n        const base64Image = buffer.toString('base64');\r\n        \r\n        // Return image sebagai data URL\r\n        const imageUrl = `data:image/png;base64,${base64Image}`;\r\n\r\n        console.log('Image generated successfully, base64 length:', base64Image.length);\r\n\r\n        return NextResponse.json({ \r\n            imageUrl,\r\n            prompt \r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Error generating image:', error);\r\n        console.error('Error stack:', error.stack);\r\n        \r\n        // Handle specific errors\r\n        let errorMessage = 'Gagal membuat gambar: ';\r\n        \r\n        if (error.message?.includes('Model') && error.message?.includes('loading')) {\r\n            errorMessage = 'Model sedang loading. Tunggu 30-60 detik dan coba lagi.';\r\n        } else if (error.message?.includes('401') || error.message?.includes('Unauthorized')) {\r\n            errorMessage = 'API key tidak valid. Periksa HUGGINGFACE_API_KEY di .env.local';\r\n        } else if (error.message?.includes('429') || error.message?.includes('rate limit')) {\r\n            errorMessage = 'Terlalu banyak request. Tunggu beberapa saat.';\r\n        } else {\r\n            errorMessage += error.message || 'Unknown error';\r\n        }\r\n        \r\n        return NextResponse.json(\r\n            { error: errorMessage },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;AAEO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,IAAI;QAEjC,IAAI,CAAC,UAAU,OAAO,WAAW,UAAU;YACvC,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAA0C,GACnD;gBAAE,QAAQ;YAAI;QAEtB;QAEA,QAAQ,GAAG,CAAC,gCAAgC;QAE5C,2CAA2C;QAC3C,IAAI,CAAC,QAAQ,GAAG,CAAC,mBAAmB,EAAE;YAClC,QAAQ,KAAK,CAAC;YACd,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAoF,GAC7F;gBAAE,QAAQ;YAAI;QAEtB;QAEA,QAAQ,GAAG,CAAC;QAEZ,6CAA6C;QAC7C,MAAM,KAAK,IAAI,6LAAW,CAAC,QAAQ,GAAG,CAAC,mBAAmB;QAE1D,iDAAiD;QACjD,MAAM,SAAS,MAAM,GAAG,WAAW,CAAC;YAChC,OAAO;YACP,QAAQ;YACR,YAAY;gBACR,iBAAiB;YACrB;QACJ;QAEA,QAAQ,GAAG,CAAC;QAEZ,qDAAqD;QACrD,MAAM,cAAc,MAAM,AAAC,OAA2B,WAAW;QACjE,MAAM,SAAS,OAAO,IAAI,CAAC;QAC3B,MAAM,cAAc,OAAO,QAAQ,CAAC;QAEpC,gCAAgC;QAChC,MAAM,WAAW,CAAC,sBAAsB,EAAE,aAAa;QAEvD,QAAQ,GAAG,CAAC,gDAAgD,YAAY,MAAM;QAE9E,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB;YACA;QACJ;IAEJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,2BAA2B;QACzC,QAAQ,KAAK,CAAC,gBAAgB,MAAM,KAAK;QAEzC,yBAAyB;QACzB,IAAI,eAAe;QAEnB,IAAI,MAAM,OAAO,EAAE,SAAS,YAAY,MAAM,OAAO,EAAE,SAAS,YAAY;YACxE,eAAe;QACnB,OAAO,IAAI,MAAM,OAAO,EAAE,SAAS,UAAU,MAAM,OAAO,EAAE,SAAS,iBAAiB;YAClF,eAAe;QACnB,OAAO,IAAI,MAAM,OAAO,EAAE,SAAS,UAAU,MAAM,OAAO,EAAE,SAAS,eAAe;YAChF,eAAe;QACnB,OAAO;YACH,gBAAgB,MAAM,OAAO,IAAI;QACrC;QAEA,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAa,GACtB;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}